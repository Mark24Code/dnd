define("arale/dnd/1.0.0/dnd",["$","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events"],function(a,b,c){function d(a){switch(a.type){case"mousedown":1===a.which&&(e({target:a.target,pageX:a.pageX,pageY:a.pageY}),x===!0&&a.preventDefault());break;case"mousemove":x===!0?f():y===!0&&(g({pageX:a.pageX,pageY:a.pageY}),h(),a.preventDefault());break;case"mouseup":x===!0?(s.remove(),s=null,q=null,x=!1):y===!0&&(y=!1,s.css("cursor","default"),s.focus(),i(),j())}}function e(a){var b=m(a.target).parents().toArray();b.unshift(a.target),m.each(b,function(a,b){if(void 0!==m(b).data("dnd")){if(q=m(b).data("dnd"),isNaN(parseInt(q,10))===!1)q=o[parseInt(q,10)],r=m(b);else if(q===!0)q=new l(b,m(b).data("config")),r=m(b);else{if(q!==!1)return!0;q=null}return!1}}),null!==q&&q.get("disabled")!==!0&&(s=null===q.get("proxy")?r.clone():q.get("proxy"),s.css({position:"absolute",left:0,top:0,visibility:"hidden"}),s.appendTo(r.parent()),s.data("originx",s.offset().left),s.data("originy",s.offset().top),s.css({left:r.offset().left-s.data("originx"),top:r.offset().top-s.data("originy"),width:r.width(),height:r.height()}),u=a.pageX-r.offset().left,v=a.pageY-r.offset().top,x=!0)}function f(){var a=q.get("visible"),b=q.get("dragCursor"),c=q.get("zIndex");a!==!0&&r.css("visibility","hidden"),s.css({"z-index":c,visibility:"visible",cursor:b}),s.focus(),w={},x=!1,y=!0,q.trigger("dragstart",w,s)}function g(a){var b=q.get("containment"),c=q.get("axis"),d=a.pageX-u,e=a.pageY-v,f=s.data("originx"),g=s.data("originy"),h=b.offset();h||(h={left:0,top:0}),"y"!==c&&(d>=h.left&&d+s.outerWidth()<=h.left+b.outerWidth()?s.css("left",d-f):d<=h.left?s.css("left",h.left-f):s.css("left",h.left+b.outerWidth()-s.outerWidth()-f)),"x"!==c&&(e>=h.top&&e+s.outerHeight()<=h.top+b.outerHeight()?s.css("top",e-g):e<=h.top?s.css("top",h.top-g):s.css("top",h.top+b.outerHeight()-s.outerHeight()-g)),q.trigger("drag",s,t)}function h(){var a=q.get("drops"),b=q.get("dragCursor"),c=q.get("dropCursor"),d=s.offset().left+u,e=s.offset().top+v;null!==a&&(null===t?m.each(a,function(a,b){return k(b,d,e)===!0?(s.css("cursor",c),s.focus(),t=m(b),q.trigger("dragenter",s,t),!1):void 0}):k(t,d,e)===!1?(s.css("cursor",b),s.focus(),q.trigger("dragleave",s,t),t=null):q.trigger("dragover",s,t))}function i(){var a=q.get("revert"),b=s.data("originx"),c=s.data("originy");null!==t&&(k(t,s)===!1&&a===!1&&(s.css("left",t.offset().left+(t.outerWidth()-s.outerWidth())/2-b),s.css("top",t.offset().top+(t.outerHeight()-s.outerHeight())/2-c)),q.trigger("drop",w,s,t))}function j(){var a=q.get("drops"),b=q.get("revert"),c=q.get("revertDuration"),d=q.get("visible"),e=q.get("zIndex"),f=s.offset().left-r.offset().left,g=s.offset().top-r.offset().top,h=s.data("originx"),i=s.data("originy");b===!0||null===t&&null!==a?s.animate({left:r.offset().left-h,top:r.offset().top-i},c,function(){r.css("visibility",""),s.remove(),s=null,q.trigger("dragend",r,t),q=null,t=null}):("relative"===r.css("position")?(f=(isNaN(parseInt(r.css("left"),10))?0:parseInt(r.css("left"),10))+f,g=(isNaN(parseInt(r.css("top"),10))?0:parseInt(r.css("top"),10))+g):"absolute"===r.css("position")?(f=s.offset().left,g=s.offset().top):r.css("position","relative"),d===!1?(r.css({left:f,top:g,visibility:"","z-index":e}),s.remove(),s=null,q.trigger("dragend",r,t),q=null,t=null):r.animate({left:f,top:g},c,function(){s.remove(),s=null,q.trigger("dragend",r,t),q=null,t=null}))}function k(a,b,c){var d=m(a).offset();return d||(d={left:0,top:0}),2===arguments.length?d.left<=m(b).offset().left&&d.left+m(a).outerWidth()>=m(b).offset().left+m(b).outerWidth()&&d.top<=m(b).offset().top&&d.top+m(a).outerHeight()>=m(b).offset().top+m(b).outerHeight():3===arguments.length?d.left<=b&&d.left+m(a).outerWidth()>=b&&d.top<=c&&d.top+m(a).outerHeight()>=c:void 0}var l=null,m=a("$"),n=a("arale/base/1.1.1/base"),o=[],p=0,q=null,r=null,s=null,t=null,u=0,v=0,w={},x=!1,y=!1;l=n.extend({attrs:{elements:{value:null,readOnly:!0},containment:{value:m(document),setter:function(a){return m(a).eq(0)}},proxy:{value:null,setter:function(a){return m(a).eq(0)}},drops:{value:null,setter:function(a){return m(a)}},disabled:!1,visible:!1,axis:!1,revert:!1,revertDuration:500,dragCursor:"move",dropCursor:"copy",zIndex:9999},initialize:function(a,b){elements=m(a),0===elements.length&&m.error("element error!"),b=m.extend({elements:elements},b),l.superclass.initialize.call(this,b),m(elements).data("dnd",p),o[p++]=this}}),l.open=function(){m(document).on("mousedown mousemove mouseup",d)},l.close=function(){m(document).off("mousedown mousemove mouseup",d)},l.open(),c.exports=l});
